<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LIPA ‚Ä¢ SME Pan-African Hub 2026</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Space+Mono&display=swap" rel="stylesheet">
<style>
:root {
    --bg:#020617; --card:#0f172a; --text:#f8fafc;
    --accent:#10b981; --crypto:#f59e0b; --vault-color:#8b5cf6;
    --border:#1e293b; --muted:#94a3b8; --danger:#ef4444;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);padding:12px;line-height:1.4;}
.container{max-width:1100px;margin:0 auto;padding-bottom:80px;}
.page { display: none; }
.active-page { display: block; }
h1{font-size:1.4rem;font-weight:800;letter-spacing:-1px;}
.tagline{font-size:0.8rem;color:var(--muted);margin-bottom:20px;}
.auth-container { max-width: 400px; margin: 60px auto; text-align: center; }
.auth-card { background: var(--card); border: 1px solid var(--border); padding: 30px; border-radius: 28px; }
.card{background:var(--card);border:1px solid var(--border);border-radius:28px;padding:22px;margin-bottom:16px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.3);}
.card-title{font-size:0.7rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:15px;display:flex;justify-content:space-between;align-items:center;}
.bal-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:15px;}
.bal-item{background:rgba(0,0,0,0.3);padding:15px;border-radius:20px;border:1px solid var(--border);}
.bal-val{font-size:1.6rem;font-weight:800;color:var(--accent);}
.bal-sub{font-family:'Space Mono';font-size:0.85rem;color:var(--crypto);}
.incentive-box { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent); padding: 12px; border-radius: 16px; margin-bottom: 15px; }
.progress-bg { background: #1e293b; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 8px; }
.progress-fill { background: var(--accent); height: 100%; width: 0%; transition: 0.3s; }
.analytics-container { display: flex; align-items: flex-end; justify-content: space-around; height: 100px; padding-top: 15px; border-top: 1px solid var(--border); }
.bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; }
.bar { width: 15px; background: var(--accent); border-radius: 4px 4px 0 0; transition: height 0.5s ease-out; min-height: 2px; }
.bar-label { font-size: 0.6rem; font-weight: 800; color: var(--muted); }
button{width:100%;padding:16px;border:none;border-radius:16px;font-weight:700;cursor:pointer;transition:0.2s;font-size:0.95rem; margin-bottom: 8px;}
button:active{transform:scale(0.98);}
.btn-primary{background:var(--accent);color:#064e3b;}
.btn-vault{background:var(--vault-color);color:white;}
.btn-swap{background:#1e293b;color:var(--crypto);border:1px solid var(--crypto);}
.btn-withdraw{background:#1e293b;color:white;border:1px solid var(--border);}
.btn-logout{background:var(--danger);color:white; font-size: 0.7rem; padding: 8px 12px; width: auto; border-radius: 8px;}
.btn-ghost{background:none; color: var(--accent); text-decoration: underline; font-size: 0.85rem;}
.btn-settle { background: #334155; color: #f1f5f9; border: 1px dashed var(--muted); }
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:1000;padding:15px;backdrop-filter:blur(10px);}
.modal-inner{background:#1e293b;border:1px solid var(--border);width:100%;max-width:400px;padding:25px;border-radius:32px;}
label{display:block;font-size:0.7rem;color:var(--muted);margin:12px 0 4px;}
input,select{width:100%;padding:14px;border-radius:12px;border:1px solid var(--border);background:#020617;color:white;font-size:1rem;margin-bottom:10px;}
.tx-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #1e293b;font-size:0.85rem;}
.grid{display:grid;gap:16px;}
@media(min-width:768px){.grid{grid-template-columns:1fr 1fr;}}
.receipt-box { background: #fff; color: #000; padding: 20px; border-radius: 12px; font-family: 'Space Mono', monospace; font-size: 0.8rem; }
.receipt-header { border-bottom: 2px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; text-align: center; }
.receipt-line { display: flex; justify-content: space-between; margin: 5px 0; }
.receipt-total { border-top: 2px dashed #ccc; margin-top: 10px; padding-top: 10px; font-weight: 800; font-size: 1rem; }
.profile-img { width: 60px; height: 60px; background: var(--accent); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
#qrCode canvas { background: #fff; padding: 10px; border-radius: 12px; border: 4px solid var(--accent); }
.scan-tag { font-family: 'Space Mono'; color: var(--accent); font-size: 0.7rem; margin-top: 8px; letter-spacing: 2px; }
.eye-toggle{cursor:pointer;}
</style>
</head>
<body>

<!-- SIGNUP PAGE -->
<div id="signupPage" class="page active-page">
    <div class="auth-container">
        <h1>LIPA <span style="color:var(--accent)">SME</span></h1>
        <p class="tagline">Pan-African Settlement Hub 2026</p>
        <div class="auth-card">
            <h3>Merchant Onboarding</h3>
            <label>Business Name</label>
            <input type="text" id="regName" placeholder="Zuri Fashions Ltd">
            <label>M-Pesa Wallet (Till / Phone)</label>
            <input type="text" id="regWallet" placeholder="e.g. 5442211 or 07xx">
            <label>Create PIN (4 Digits)</label>
            <input type="password" id="regPin" maxlength="4" placeholder="****">
            <button class="btn-primary" onclick="linkAndProceed()">Link Wallet & Create Account</button>
            <p style="font-size:0.8rem; color:var(--muted)">Already a merchant? <button class="btn-ghost" onclick="navigateTo('loginPage')">Login</button></p>
        </div>
    </div>
</div>

<!-- LOGIN PAGE -->
<div id="loginPage" class="page">
    <div class="auth-container">
        <h1>LIPA <span style="color:var(--accent)">ACCESS</span></h1>
        <div class="auth-card">
            <h3>Merchant Login</h3>
            <label>Business Email</label>
            <input type="email" placeholder="admin@zuri.africa">
            <label>Access PIN</label>
            <input type="password" maxlength="4" placeholder="****">
            <button class="btn-primary" onclick="navigateTo('dashboardPage')">Unlock Dashboard</button>
            <button class="btn-ghost" onclick="navigateTo('signupPage')">New Merchant Sign-up</button>
        </div>
    </div>
</div>

<!-- DASHBOARD PAGE -->
<div id="dashboardPage" class="page">
    <div class="container">
        <header style="display:flex; justify-content:space-between; align-items:center; padding: 20px 0;">
            <div>
                <h1>LIPA <span style="color:var(--accent)">SME</span></h1>
                <p class="tagline">Global African Settlement</p>
            </div>
            <button class="btn-logout" onclick="navigateTo('loginPage')">Log Out</button>
        </header>

        <div class="card" style="text-align: center; border-bottom: 3px solid var(--accent);">
            <div class="profile-img">üè¢</div>
            <h2 id="merchantTitle">Zuri Fashions Ltd</h2>
            <p style="color:var(--muted); font-size: 0.8rem;" id="walletInfo">Tier 1 Merchant ‚Ä¢ M-Pesa Linked</p>
            <div id="walletStatus" style="font-size: 0.6rem; color: var(--accent); margin-top: 5px;">‚óè DARAJA LIVE GATEWAY</div>
        </div>

        <div class="card">
            <div class="card-title">üìä Revenue Analysis <span>By Origin Currency</span></div>
            <div class="analytics-container" id="analysisChart"></div>
        </div>

        <div class="card">
            <div class="card-title">üí∞ Operating Liquidity <span class="eye-toggle" onclick="toggleBalances()">üëÅ</span></div>
            <div class="bal-row">
                <div class="bal-item">
                    <label>FIAT (KES)</label>
                    <div class="bal-val" id="fiatBal">10,000.00</div>
                </div>
                <div class="bal-item">
                    <label>CRYPTO (USDT)</label>
                    <div class="bal-sub" id="cryptoBal">0.00</div>
                </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                <button class="btn-swap" onclick="openModal('swapModal')">üí± Swap</button>
                <button class="btn-withdraw" onclick="openModal('withdrawModal')">üèß Withdraw</button>
            </div>
            <button class="btn-settle" onclick="processEndOfBusiness()">üèÅ Close Business Day (15% Vault)</button>
        </div>

        <div class="card" style="border-color:var(--vault-color);">
            <div class="card-title" style="color:var(--vault-color)">üîí Vault <span class="eye-toggle" onclick="toggleVault()">üëÅ</span></div>
            <div style="text-align:center;padding:10px 0;">
                <div style="font-size:2.2rem;font-weight:800;color:var(--vault-color);" id="vaultBal">KES 50,000.00</div>
                <p style="color:var(--muted);font-size:0.75rem;">PIN required to move funds</p>
            </div>
            <button class="btn-vault" onclick="openModal('vaultOutModal')">Unlock & Move Funds</button>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-title">‚ö° Instant Terminal</div>
                <label>Amount</label>
                <input id="termAmt" type="number" value="1500">
                <label>Currency & Method</label>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                    <select id="termCur">
                        <option value="KES">KES (Kenya)</option>
                        <option value="USD">USD (Global)</option>
                        <option value="EUR">EUR (Europe)</option>
                        <option value="GBP">GBP (UK)</option>
                        <option value="NGN">NGN (Nigeria)</option>
                        <option value="ZAR">ZAR (S. Africa)</option>
                        <option value="CNY">CNY (China)</option>
                        <option value="INR">INR (India)</option>
                        <option value="USDT">USDT (Crypto)</option>
                    </select>
                    <select id="termMeth">
                        <option value="MoMo">M-Pesa</option>
                        <option value="MTN">MTN MoMo</option>
                        <option value="Airtel">Airtel Money</option>
                        <option value="ApplePay">Apple Pay</option>
                        <option value="NFC">NFC Tap</option>
                        <option value="Crypto">Crypto</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="initiatePayment()">Accept Payment</button>
            </div>

            <div class="card">
                <div class="card-title">üìã Transaction Ledger</div>
                <div class="incentive-box">
                    <div style="display:flex; justify-content:space-between; font-size:0.7rem; font-weight:800;">
                        <span style="color:var(--accent)">‚ö° EMPLOYEE BONUS TRACKER</span>
                        <span id="incentiveCount">0 / 10 Payments</span>
                    </div>
                    <div class="progress-bg"><div id="progressBar" class="progress-fill"></div></div>
                </div>
                <div id="ledger"></div>
            </div>
        </div>
    </div>
</div>

<!-- MODALS -->
<div class="modal" id="payModal">
    <div class="modal-inner" style="text-align:center;">
        <h2 id="pTitle" style="color:var(--accent); font-weight:800; font-size:1.8rem;">SCAN TO PAY</h2>
        <div id="qrCode" style="margin:20px 0; display: flex; justify-content: center;"></div>
        <div class="scan-tag">LIPA MERCHANT TERMINAL</div>
        <p id="pDesc" style="font-size:1.4rem; font-weight:800; color:var(--text); margin-top:15px;"></p>
        <p style="font-size:0.7rem; color:var(--muted); margin-bottom:20px;">Passenger scans the code above to authorize</p>
        <button class="btn-primary" onclick="confirmPayment()">Verify & Settle</button>
        <button class="btn-secondary" style="margin-top:10px;background:none;color:white;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<!-- SWAP, WITHDRAW, VAULT, RECEIPT MODALS -->
<div class="modal" id="swapModal">
    <div class="modal-inner">
        <h2>üí± Swap Funds</h2>
        <label>Direction</label>
        <select id="swapDir">
            <option value="K2C">KES ‚Üí USDT</option>
            <option value="C2K">USDT ‚Üí KES</option>
        </select>
        <label>Amount (Source Currency)</label>
        <input id="swapAmt" type="number" placeholder="Enter Amount">
        <p style="font-size:0.65rem; color:var(--crypto); margin-bottom:10px;">Rate: 1 USDT = 132.50 KES</p>
        <button class="btn-primary" style="background:var(--crypto);color:#000;" onclick="executeSwap()">Confirm Swap</button>
        <button class="btn-secondary" style="margin-top:10px;background:none;color:white;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<div class="modal" id="withdrawModal">
    <div class="modal-inner">
        <h2>üèß Withdraw</h2>
        <label>Destination</label>
        <select id="withdrawWallet"><option>Linked M-Pesa</option><option>Bank Account</option><option>Airtel Money</option></select>
        <label>Account / Phone Number</label>
        <input type="text" id="wdAccount" placeholder="e.g. 0712345678">
        <label>Amount</label>
        <input type="number" id="wdAmt">
        <label>PIN</label>
        <input type="password" id="wdPin" maxlength="4" placeholder="****">
        <button class="btn-primary" onclick="executeWithdrawal()">Withdraw Now</button>
        <button class="btn-secondary" style="margin-top:10px;background:none;color:white;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<div class="modal" id="vaultOutModal">
    <div class="modal-inner">
        <h2 style="color:var(--vault-color)">Unlock Vault</h2>
        <label>Amount to Move (KES)</label>
        <input type="number" id="vMoveAmt" placeholder="Enter Amount">
        <label>Security PIN</label>
        <input type="password" id="vPin" maxlength="4" style="text-align:center;letter-spacing:10px;font-size:1.5rem;">
        <p style="font-size:0.6rem; color:var(--muted); text-align:center; margin-bottom:10px;">Move funds from locked savings to active liquidity</p>
        <button class="btn-vault" onclick="executeVaultUnlock()">Unlock & Move</button>
        <button class="btn-secondary" style="margin-top:10px;background:none;color:white;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<div class="modal" id="receiptModal">
    <div class="modal-inner">
        <div class="receipt-box" id="receiptContent"></div>
        <button class="btn-primary" style="margin-top:20px;" onclick="closeModals()">Done</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script>
// FX Rates, State, & Utilities
const FX = { KES:1, USD:132.5, USDT:132.5, NGN:0.09, ZAR:7.2, GHS:10.5, EUR:142.1, GBP:168.4, CNY:18.3, INR:1.58 };
let volData = { USD: 1500, KES: 8000, EUR: 500, USDT: 200, NGN: 0 };
let state={fiat:12500,cryptoUSDT:0,vault:45000,tx:[], merchantWallet: "", digitalCount: 0};
let activeTx=null,balancesVisible=true,vaultVisible=true;

function linkAndProceed() {
    const name = document.getElementById('regName').value;
    const wallet = document.getElementById('regWallet').value;
    if(!name || !wallet) return alert("Please enter Business Name and Wallet details");
    state.merchantWallet = wallet;
    navigateTo('loginPage');
}

function navigateTo(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
    document.getElementById(pageId).classList.add('active-page');
    if(pageId === 'dashboardPage') {
        const name = document.getElementById('regName').value;
        if(name) document.getElementById('merchantTitle').innerText = name;
        if(state.merchantWallet) document.getElementById('walletInfo').innerText = `Wallet: ${state.merchantWallet} ‚Ä¢ M-Pesa Linked`;
        updateUI();
    }
}

function updateUI(){
    document.getElementById('fiatBal').innerText=balancesVisible?state.fiat.toLocaleString():"****";
    document.getElementById('cryptoBal').innerText=balancesVisible?state.cryptoUSDT.toFixed(2)+" USDT":"****";
    document.getElementById('vaultBal').innerText=vaultVisible?("KES "+state.vault.toLocaleString()):"****";
    document.getElementById('incentiveCount').innerText = `${state.digitalCount} / 10 Payments`;
    document.getElementById('progressBar').style.width = (state.digitalCount * 10) + "%";

    const chart = document.getElementById('analysisChart'); chart.innerHTML = '';
    const maxVal = Math.max(...Object.values(volData), 1000);
    Object.keys(volData).forEach(cur => {
        const h = (volData[cur] / maxVal) * 100;
        chart.innerHTML += `<div class="bar-wrap"><div class="bar" style="height:${h}%"></div><span class="bar-label">${cur}</span></div>`;
    });

    const ledger=document.getElementById('ledger');
    ledger.innerHTML=state.tx.slice(0,5).map(t=>`
    <div class="tx-item">
        <div><strong>${t.type}</strong><br><small>${t.time}</small></div>
        <div style="color:${t.flow==='IN'?'var(--accent)':'var(--danger)'}">
            ${t.flow==='IN'?'+':'-'}${t.localAmt.toLocaleString()} KES
        </div>
    </div>`).join('')||'<p style="text-align:center;padding:20px;color:var(--muted)">No transactions</p>';
}

function initiatePayment(){
    const amt=parseFloat(document.getElementById('termAmt').value);
    const cur=document.getElementById('termCur').value;
    const meth=document.getElementById('termMeth').value;
    if(!amt||amt<=0) return;
    activeTx={ref:"REF-"+Math.random().toString(36).substr(2,5).toUpperCase(),amt,cur,meth,localAmt:(amt * FX[cur])};
    document.getElementById('pDesc').innerText=`TOTAL: ${amt} ${cur}`;
    document.getElementById('qrCode').innerHTML = ''; 
    const qrCanvas = document.createElement('canvas');
    new QRious({element: qrCanvas, value: `LIPA_PRO_2026|${activeTx.ref}|${activeTx.amt}|${activeTx.cur}|WALLET:${state.merchantWallet}`, size: 220, level: 'H'});
    document.getElementById('qrCode').appendChild(qrCanvas);
    openModal('payModal');
}

function confirmPayment(){
    if(activeTx.cur==="USDT") state.cryptoUSDT += activeTx.amt;
    else state.fiat += activeTx.localAmt;
    state.digitalCount++; 
    if(state.digitalCount>=10){state.digitalCount=0; state.fiat+=50; state.tx.unshift({type:"üéä Employee Bonus", time:new Date().toLocaleTimeString(), localAmt:50, flow:'IN'}); alert("üéâ 10 digital payments processed! Bonus KES 50 added!");}
    if(volData[activeTx.cur] !== undefined) volData[activeTx.cur]+=activeTx.localAmt;
    state.tx.unshift({type:activeTx.meth, time:new Date().toLocaleTimeString(), localAmt:activeTx.localAmt, flow:'IN'});
    showReceipt(activeTx);
}

function executeWithdrawal(){
    const amt=parseFloat(document.getElementById('wdAmt').value);
    const pin=document.getElementById('wdPin').value;
    if(amt>state.fiat) return alert("Insufficient balance");
    if(pin!=="1234") return alert("Wrong PIN");
    state.fiat-=amt;
    state.tx.unshift({type:"Withdrawal", time:new Date().toLocaleTimeString(), localAmt:amt, flow:'OUT'});
    closeModals(); updateUI();
}

function executeVaultUnlock(){
    const amt = parseFloat(document.getElementById('vMoveAmt').value);
    const pin = document.getElementById('vPin').value;
    if(pin!=="1234") return alert("Incorrect Vault PIN");
    if(!amt||amt<=0) return alert("Enter valid amount");
    if(amt>state.vault) return alert("Insufficient Vault Balance");
    state.vault-=amt; state.fiat+=amt;
    state.tx.unshift({type:"Vault Release", time:new Date().toLocaleTimeString(), localAmt:amt, flow:'IN'});
    closeModals(); updateUI();
}

function executeSwap(){
    const dir = document.getElementById('swapDir').value;
    const amt = parseFloat(document.getElementById('swapAmt').value);
    const rate = FX.USDT;
    if(!amt||amt<=0) return alert("Enter valid amount");
    if(dir==="K2C"){ if(state.fiat<amt) return alert("Insufficient KES"); state.fiat-=amt; state.cryptoUSDT+=(amt/rate); state.tx.unshift({type:"Swap (KES‚ÜíUSDT)", time:new Date().toLocaleTimeString(), localAmt:amt, flow:'OUT'});}
    else{ if(state.cryptoUSDT<amt) return alert("Insufficient USDT"); const fiatGain=amt*rate; state.cryptoUSDT-=amt; state.fiat+=fiatGain; state.tx.unshift({type:"Swap (USDT‚ÜíKES)", time:new Date().toLocaleTimeString(), localAmt:fiatGain, flow:'IN'});}
    closeModals(); updateUI(); alert("Swap executed successfully");
}

function processEndOfBusiness(){
    if(state.fiat<=0) return alert("No liquidity to settle.");
    const deduction = state.fiat*0.15;
    state.fiat-=deduction; state.vault+=deduction;
    state.tx.unshift({type:"EOD Settlement (15%)", time:new Date().toLocaleTimeString(), localAmt:deduction, flow:'OUT'});
    document.getElementById('receiptContent').innerHTML=`
        <div class="receipt-header"><h3>SHIFT CLOSED</h3><p>${new Date().toLocaleDateString()}</p></div>
        <div class="receipt-line"><span>Wallet:</span> <span>${state.merchantWallet}</span></div>
        <div class="receipt-line"><span>Total Settled:</span> <span>${deduction.toLocaleString()} KES</span></div>
        <div class="receipt-total"><div class="receipt-line"><span>REMAINING FIAT:</span> <span>${state.fiat.toLocaleString()} KES</span></div></div>`;
    updateUI(); openModal('receiptModal');
}

function showReceipt(tx){
    document.getElementById('receiptContent').innerHTML=`
        <div class="receipt-header"><h3>LIPA SUCCESS</h3><p>${tx.ref}</p></div>
        <div class="receipt-line"><span>Recipient:</span> <span>${state.merchantWallet}</span></div>
        <div class="receipt-line"><span>Paid:</span> <span>${tx.amt} ${tx.cur}</span></div>
        <div class="receipt-total"><div class="receipt-line"><span>SETTLED:</span> <span>${tx.localAmt.toLocaleString()} KES</span></div></div>`;
    closeModals(); openModal('receiptModal'); updateUI();
}

function toggleBalances(){balancesVisible=!balancesVisible;updateUI();}
function toggleVault(){vaultVisible=!vaultVisible;updateUI();}
function openModal(id){document.getElementById(id).style.display='flex';}
function closeModals(){document.querySelectorAll('.modal').forEach(m=>m.style.display='none');}
updateUI();
</script>

</body>
</html>